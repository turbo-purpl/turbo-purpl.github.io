# Telegram WebApp API - Как это работает

## Проблема
Веб-приложение на `https://turbo-purpl.github.io` не может обратиться к `http://localhost:8080` из-за CORS.

## Решение через Telegram WebApp API

### Как это работает:

1. **Веб-приложение отправляет данные через `tg.sendData()`**
   - Данные отправляются боту как сообщение типа `web_app_data`
   - Бот получает данные через обработчик `handle_webapp_data`

2. **Бот обрабатывает запрос и отправляет ответ**
   - Бот отправляет ответ через `message.answer()` в чат
   - Ответ содержит JSON с данными

3. **Проблема получения ответа**
   - Telegram WebApp API не предоставляет прямого способа получить ответ от бота
   - Ответ приходит в чат, а не в веб-приложение

### Варианты решения:

#### Вариант 1: Использовать Telegram Bot API для получения ответов
- Веб-приложение может использовать Telegram Bot API для получения последних сообщений
- Но это требует токен на клиенте (небезопасно)

#### Вариант 2: Использовать localStorage + polling
- Бот сохраняет ответ в БД
- Веб-приложение делает polling запросы к боту через Bot API
- Тоже требует токен

#### Вариант 3: Комбинированный подход (текущий)
- Пробуем отправить через `tg.sendData()`
- Если не работает или таймаут - используем fallback на прямой API
- Для локальной разработки используем `http://localhost:8080`
- Для продакшена нужен публичный API сервер

### Текущая реализация:

1. Веб-приложение отправляет запрос через `API.sendToBot()`
2. Если WebApp API доступен - используем `tg.sendData()`
3. Если таймаут или ошибка - fallback на прямой API (если настроен)
4. Бот обрабатывает запрос и отправляет ответ в чат

### Что нужно доработать:

Для полноценной работы через WebApp API нужно:
- Либо использовать публичный API сервер
- Либо реализовать механизм получения ответов от бота (через Bot API или другой способ)

